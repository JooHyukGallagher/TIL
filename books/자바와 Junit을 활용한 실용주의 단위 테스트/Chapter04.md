# 4. 테스트 조직

## 4.1 AAA로 테스트 일관성 유지
- 준비(Arrange): 테스트 코드를 실행하기 전에 시스템이 적절한 상태에 있는지를 확인한다. 객체들을 생성하거나 이것과 의사소통하거나 다른 API를 호출하는 것 등입니다. 드물지만 시스템이 우리가 필요한 상태로 있다면 준비를 생략하기도 합니다.
- 실행(Act): 테스트 코드를 실행합니다. 보통은 단일 메서드를 호출합니다.
- 단언(Assert): 실행한 코드가 기대한 대로 동작하는지 확인합니다. 실행한 코드의 반환값 혹은 그 외 필요한 객체들의 새로운 상태를 검사합니다. 또 테스트한 코드와 다른 객체들 사이의 의사소통을 검사하기도 합니다.
- 사후(After): 테스트를 실행할 때 어떤 자원을 할당했다면 잘 정리 되었는지 확인해야 합니다.

## 4.2 동작 테스트 VS 메서드 테스트
테스트를 작성할 때는 클래스 동작에 집중해야 하며 개별 메서드를 테스트한다고 생각하면 합니다.

## 4.3 테스트와 프로덕션 코드의 관계
- 테스트는 주어진 프로젝트 안에서 프로덕션 코드와 분리해야 합니다. 프로덕션 코드는 테스트 코드이 존재를 알지 못합니다.
- 테스트를 위해 내부 데이터를 노출하는 것은 테스트와 프로덕션 코드 사이에 과도한 결합을 초래합니다.
- 내부 행위를 테스트하려는 충동이 든다면 설계에 문제가 있는 것입니다.

## 4.4 집중적인 단일 목적 테스트의 가치
다수의 케이스를 별도의 JUnit 테스트 메서드로 분리하세요. 각각에는 검증하는 동작을 표현하는 이름을 붙이세요.
- 단언이 실패했을 때 실패한 테스트 이름이 표시되기 때문에 어느 동작에서 문제가 있는지 빠르게 파악할 수 있습니다.
- 실패한 테스트를 해독하는 데 필요한 시간을 줄일 수 있습니다. JUnit은 각 테스트를 별도의 인스턴스로 실행하기 때문입니다. 따라서 현재 실패한 테스트에 대해 다른 테스트의 영향을 제거할 수 있습니다.
- 모든 케이스가 실행되었음을 보장할 수 있습니다. 단언이 실패하면 현재 테스트 메서드는 중단합니다. 단언 실패는 java.lang.AssertionsError를 던지기 때문입니다.(JUnit은 이것을 잡아 테스트를 실패로 표시합니다.) 단언 실패 이후의 테스트 케이스는 실행되지 않습니다.

## 4.5 문서로서의 테스트
단위 테스트는 우리가 만드는 클래스에 대한 지속적이고 믿을 수 있는 문서 역할을 해야 합니다.
### 4.5.1 일관성 있는 이름으로 테스트 문서화
좀 더 작은 테스트로 이동할수록 각각은 분명한 행동에 집중합니다. 또 각테스트 이름에 더 많은 의미를 부여할 수 있습니다. 테스트하려는 맥락을 제안하기 보다는 어떤 맥락에서 일련의 행동을 호출했을 때 어떤 결과가 나오는지를 명시하세요.

멋지지 않은 이름 | 멋지고 설명적인 이름
|:---|:---|
makeSingleWithdrawal | withdrawalReduceBalanceByWithdrawnAmount
attemptToWithdrawTooMuch | withdrawalOfMoreThanAvailableFundsGeneratesError
multipleDeposits | multipleDepositsIncreaseBalanceBySumOfDeposits

<br>

#### 테스트 이름 형식
- doingSomeOperationGenerateSomeResult(어떤 동작을 하면 어떤 결과가 나온다.)
- someResultOccursUnderSomeConditionㅇ어떤 결과는 어떤 조건에서 발생한다.)
- givenSomeContextWhenDoingSomeBehaviorThenSomeResultOccurs(주어진 조건에서 어떤 일을 하면 어떤 결과가 나온다.)
- whenDoingSomeBehaviorThenSomeResultOccurs

### 4.5.2 테스트를 의미 있게 만들기
다른 사람(혹은 여러분 자신)이 테스트가 어떤 일을 하는지 파악하기 어려워한다면 주석을 추가하는 것만으로 끝내지 마세요. 테스트 이름을 개선해야 합니다. 또 다음도 고려해야 합니다.
- 지역 변수 이름 개선하기
- 의미 있는 상수 도입하기
- AssertJ 사용하기
- 커다란 테스트를 작게 나누어 집중적인 테스트 만들기
- 테스트 군더더기들을 도우미 메서드와 @Before 메서드로 이동하기
> 테스트 이름과 코드를 재작업하여 부가적으로 주석을 넣지 않고도 스토리를 알 수 있도록 만드세요.

## 4.6 @Before와 @After(공통 초기화와 정리) 더 알기
- 다수의 @Before 메서드가 있을 때 JUnit은 어떤 실행 순서를 보장하지 않습니다.
- 일정한 순서가 필요하다면 단일 @Before 메서드로 결합하여 순서대로 실행되도록 해야 합니다.

## 4.7 녹색이 좋다: 테스트를 의미 있게 유지
실패하는 테스트가 있다면 더 늘리지 마세요! 실패하면 곧바로 고쳐서 모든 테스트가 항상 통과하도록 해야 합니다. '항상 녹색으로'가 프로덕션 코드를 변경해야 할 때 코드에 오류가 없도록 지켜 줍니다.
